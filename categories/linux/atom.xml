<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: linux | Starsea's Note]]></title>
  <link href="http://starsea.github.io/categories/linux/atom.xml" rel="self"/>
  <link href="http://starsea.github.io/"/>
  <updated>2014-07-25T16:05:31+08:00</updated>
  <id>http://starsea.github.io/</id>
  <author>
    <name><![CDATA[starsea]]></name>
    <email><![CDATA[starsea820@gmail.com]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[centos 安装后需要做的很多事情]]></title>
    <link href="http://starsea.github.io/posts/install-centos-on-mac-vagrant/"/>
    <updated>2014-07-17T00:21:23+08:00</updated>
    <id>http://starsea.github.io/posts/install-centos-on-mac-vagrant</id>
    <content type="html"><![CDATA[<p>装上 vagrant 了.但是 centos 是 minimal 版的,所以需要做很多东西(不是 mini 版的也需要做很多事 囧rz).其实很多事情都是玩 vps 的时候做过的,但是人老了记性不好,每次都要 google. 所以我觉得还是记录下来比较好.</p>

<p>先添加源吧..啥也不说了 直接上<a href="http://mirrors.aliyun.com/help/centos" title="阿里云开源镜像">阿里云</a>的开源镜像吧..网易萎了..
<code>bash
mv /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.backup
cd /etc/yum.repos.d
wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-6.repo
yum clean all
yum makecache
</code></p>

<!--more-->


<h3>sudo command 找不到命令</h3>

<p>编译 nginx 的时候把 nginx 放在了/usr/local/bin 下 用 sudo 执行的时候提示找到不到命令 很奇怪 切换到 root 去执行 nginx 却可以 看了下 root 的path 明明有包含这个路径&hellip;</p>

<p>查了下资料后发现是 sudo 的原因</p>

<p>我们使用 <code>sudo visudo</code> 可以看到</p>

<p>```bash</p>

<h1>Preserving HOME has security implications since many programs</h1>

<h1>use it when searching for configuration files. Note that HOME</h1>

<h1>is already set when the the env_reset option is enabled, so</h1>

<h1>this option is only effective for configurations where either</h1>

<h1>env_reset is disabled or HOME is present in the env_keep list.</h1>

<p>#
Defaults    always_set_home</p>

<p>Defaults    env_reset
Defaults    env_keep =  &ldquo;COLORS DISPLAY HOSTNAME HISTSIZE INPUTRC KDEDIR LS_COLORS&rdquo;
Defaults    env_keep += &ldquo;MAIL PS1 PS2 QTDIR USERNAME LANG LC_ADDRESS LC_CTYPE&rdquo;
Defaults    env_keep += &ldquo;LC_COLLATE LC_IDENTIFICATION LC_MEASUREMENT LC_MESSAGES&rdquo;
Defaults    env_keep += &ldquo;LC_MONETARY LC_NAME LC_NUMERIC LC_PAPER LC_TELEPHONE&rdquo;
Defaults    env_keep += &ldquo;LC_TIME LC_ALL LANGUAGE LINGUAS _XKB_CHARSET XAUTHORITY&rdquo;</p>

<p>#</p>

<h1>Adding HOME to env_keep may enable a user to run unrestricted</h1>

<h1>commands via sudo.</h1>

<p>#</p>

<h1>Defaults   env_keep += &ldquo;HOME&rdquo;</h1>

<p>Defaults    secure_path = /sbin:/bin:/usr/sbin:/usr/bin
<code>``
这里每次调用 sudo 应用的环境变量是..</code>/sbin:/bin:/usr/sbin:/usr/bin` 难怪找不到..</p>

<p>一个简单解决方案就是 <code>vi ~/.bashrc</code>
<code>bash
alias sudo="sudo env PATH=$PATH"
</code></p>

<p>因为系统预装的 sudo 在编译时缺省使用了 &mdash;with-secure-path 参数，因此当前用户使用 sudo 时环境变量 $PATH 被覆盖，通过添加上面那行别名设置，就会在执行 sudo 时把当前的 $PATH 的值再套用上，达到想要的效果。</p>

<p>上面这种 alias 并不是最完美的方式 有时候我们可能会查看一些 sudo 的配置 比如 <code>sudo -l</code> 会翻译成 <code>sudo env PATH=$PATH -l</code> 但是这个命令是无效的&hellip;因为 -l 等参数必须放在env 前面..所以我们还是用<code>sudo visudo</code>手动修改 secure_path 的值把.</p>

<p>当然，最根本的解决办法还是重新编译安装 sudo，编译时不使用 &mdash;with-secure-path 参数即可。有兴趣可以试下</p>

<p>参阅:</p>

<ul>
<li><a href="http://www.ibm.com/developerworks/cn/aix/library/au-sudo/index.html">充分发挥 sudo 的作用</a></li>
<li><a href="http://pickerwengs.blogspot.com/2011/10/sudo-command-not-found.html">sudo-command-not-found</a></li>
</ul>

]]></content>
  </entry>
  
</feed>
